{% extends "base.html" %}

{% block title %}Analytics{% endblock %}

{% block content %}
<h1>Analytics</h1>

<div class="analytics">
    <h2>Global Metrics</h2>
    <canvas id="globalMetricsChart"></canvas>
    <h3>Top 3 Posts</h3>
    <div id="topPosts">
        {% for post in top_posts %}
        <div class="post-analytics">
            <h4>Post {{ post.id }}</h4>
            <p>Likes: {{ post.likes }}</p>
            <p>Dislikes: {{ post.dislikes }}</p>
            <p>Comments: {{ post.comments | length }}</p>
        </div>
        {% endfor %}
    </div>

    <h2>Individual Post Metrics</h2>
    {% for post in posts %}
    <div class="post-analytics">
        <h3>Post {{ post.id }}</h3>
        <canvas id="postMetricsChart-{{ post.id }}"></canvas>
        <p>Likes: {{ post.likes }}</p>
        <p>Dislikes: {{ post.dislikes }}</p>
        <p>Comments: {{ post.comments | length }}</p>
    </div>
    {% endfor %}
</div>
{% endblock %}

{% block scripts %}
<script>
    const globalLikes = {{ global_likes }};
    const globalDislikes = {{ global_dislikes }};
    const globalComments = {{ global_comments | tojson | safe }}; // Use tojson if it's a JSON object
    const postsData = {{ posts | tojson | safe }}; // Ensure this is a valid JSON object
</script>
<script src="{{ url_for('static', filename='analytics.js') }}"></script>
{% endblock %}